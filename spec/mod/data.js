require("data",function(e,r){function n(e){if(Array.isArray(e)){"number"!=typeof e.$key&&(e.$key=1);var r=[];e.forEach(function(t){("object"!=typeof t||Array.isArray(t))&&(t={value:t}),"number"!=typeof t.$key&&(t.$key=e.$key++),n(t),r.push(t)}),e.splice(0,e.length),r.forEach(function(r){e.push(r)})}else if("object"==typeof e){var t;for(t in e)n(e[t])}}function t(r,n){switch(n){case"date":return r=e.num2dat(r),i[r.getMonth()]+" "+r.getDate()+", "+r.getFullYear();case"time":return r=e.num2dat(r),r.getHours()+":"+e.pad(r.getMinutes());case"datetime":return r=e.num2dat(r),i[r.getMonth()]+" "+r.getDate()+", "+r.getFullYear()+"  "+r.getHours()+":"+e.pad(r.getMinutes())}return r}function a(e){var r,n,t=0,a=0,u=0,o=[];for(a=0;a<e.length;a++)n=e.charAt(a),0==u?"["!=n&&"."!=n||(r={name:e.substr(t,a-t)},o.push(r),t=a+1,"["==n&&(u=1)):-1==u?"."==n?(t=a+1,u=0):console.error("Bad var name!\n"+e+"\nPos: "+a):"["==n?u++:"]"==n&&(u--,0==u&&(r.index=e.substr(t,a-t),t=a+1,u=-1));return 0==u?o.push({name:e.substr(t)}):console.error("Bad ending for var name!\n"+e),o}var u=(require("tfw.web-service"),require("tfw.storage").local),o=u.get("data",{})||{},i=["January","February","March","April","May","June","July","August","September","October","November","December"];e.log=function(e){e?console.info("[data] DATA=...",JSON.stringify(o,null,"  ")):console.info("[data] DATA=...",o)},e.get=function(r){var n,t,u,i=o,f=a(r);for(u=0;u<f.length;u++){if(n=f[u],i=i[n.name],"undefined"==typeof i)return;if(Array.isArray(i)&&n.index&&(t=e.get(n.index),i=i.find(function(e){return e.$key==t}),"undefined"==typeof i))return void console.error("Key `"+t+"` not found in `"+r+"` at level "+u+"!")}return i},e.set=function(r,t){"undefined"==typeof t&&(t=""),t=JSON.parse(JSON.stringify(t)),n(t);var u,i,f,s,d=o,y=a(r);for(s=0;s<y.length-1;s++)i=y[s],"undefined"==typeof d[i.name]&&(y.index?d[i.name]=[{$key:e.get(i.index)}]:d[i.name]={}),d=d[i.name],i.index&&(f=e.get(i.index),u=d.find(function(e){return e.$key==f}),"undefined"==typeof u?d.push({$key:f}):d=u);d[y.pop().name]=t},e.reset=function(){var r=o.arg0,n=o.arg1,t=o.arg2,a=o.arg3;o={arg0:r,arg1:n,arg2:t,arg3:a},e.save()},e.save=function(){u.set("data",o)},e.parse=function(r,n){if("undefined"==typeof n&&(n={}),Array.isArray(r)){var a,u,o;for(a=0;a<r.length;a++)if(u=r[a],o=e.parse(u),"undefined"!=typeof o&&"null"!==o)return o}else{if("function"==typeof r)return e.parse(r.call(e));if("string"==typeof r){for(var i,f,s,d=0,y="";;){if(i=r.indexOf("{{",d),-1==i)break;if(y+=r.substr(d,i-d),d=i+2,f=r.indexOf("}}",d),-1==f)break;for(s=r.substr(d,f-d).trim().split("|"),"undefined"!=typeof n[s[0]]?s[0]=n[s[0]]:s[0]=e.get(s[0])||"",a=1;a<s.length;a++)s[0]=t(s[0],s[a]);y+=s[0],d=f+2}return y+r.substr(d)}}},e.num2dat=function(e){for(var r=""+e;r.length<12;)r+="0";return new Date(parseInt(r.substr(0,4)),parseInt(r.substr(4,2))-1,parseInt(r.substr(6,2)),parseInt(r.substr(8,2)),parseInt(r.substr(10,2)),0)},e.pad=function(e,r,n){for("undefined"==typeof r&&(r=2),"undefined"==typeof n&&(n="0"),e=""+e;e.length<r;)e=n+e;return e},e.push=function(r,t){var a=e.get(r);return Array.isArray(a)?(n(a),("object"!=typeof t||Array.isArray(t))&&(t={value:t}),t.$key=a.$key++,a.push(t),t.$key):(console.error("[Data.push] `"+r+"` is not an array!"),0)},e.remove=function(r,n){var t=e.get(r),a=e.get(n),u=t.findIndex(function(e){return e.$key==a});return-1==u?!1:(t.splice(u,1),!0)}});
//# sourceMappingURL=data.js.map